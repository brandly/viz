(function(){var t,e,n,i,r;r=window,i=r.requestAnimationFrame||r.mozRequestAnimationFrame||r.webkitRequestAnimationFrame||r.oRequestAnimationFrame,n=function(){},t=function(){function t(t){this.setFunction(t)}return t.prototype.request=null,t.prototype.setFunction=function(t){return this.fn=function(e){return function(){return t(),e.start()}}(this)},t.prototype.start=function(){return this.request=i(this.fn)},t.prototype.stop=function(){return this.request?(r.cancelAnimationFrame(this.request),this.request=null):void 0},t}(),e=function(){function e(t,e){var n,i,r,a,s;if(this.id=t,this.frequency=e.frequency,this.time=e.time,this.element=document.getElementById(this.id),!this.element)throw'No element found with id "'+t+'"';if(n=this.element.getElementsByTagName("audio"),!n.length)throw"No <audio> element found inside #"+t;if(this.audio=n[0],a=this.element.getElementsByTagName("canvas"),!a.length)throw"No <canvas> element found inside #"+t;this.canvas=a[0],this.canvasContext=this.canvas.getContext("2d"),i=new webkitAudioContext,this.analyser=i.createAnalyser(),s=i.createMediaElementSource(this.audio),s.connect(this.analyser),this.analyser.connect(i.destination),this.audio.addEventListener("play",this.start.bind(this),!1),r=this.stop.bind(this),this.audio.addEventListener("pause",r,!1),this.audio.addEventListener("ended",r,!1)}return e.prototype.repeater=new t,e.prototype.start=function(){var t,e;return t=function(t){return function(){var e;return e=new Uint8Array(t.analyser.frequencyBinCount),t.analyser.getByteFrequencyData(e),t.frequency(e,t.canvasContext,t.canvas)}}(this),e=function(t){return function(){var e;return e=new Uint8Array(t.analyser.frequencyBinCount),t.analyser.getByteTimeDomainData(e),t.time(e,t.canvasContext,t.canvas)}}(this),this.frequency||(t=n),this.time||(e=n),this.repeater.setFunction(function(n){return function(){return n.canvas.width=n.canvas.width,t(),e()}}(this)),this.repeater.start()},e.prototype.stop=function(){return this.repeater.stop()},e}(),window.Viz=e}).call(this);